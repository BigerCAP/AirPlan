<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>æ€»ç»“ - Syncer åŠ©åŠ›æ€ç»´æˆé•¿ - TiDB AirPlan - A biger solution</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jeff" /><meta name="description" content="0x00 èƒŒæ™¯ é•¿æœŸä½¿ç”¨ Syncer ä¹‹åç»è¿‡ä¸€ç•ªèƒ¡æ€ä¹±æƒ³ä¹‹åçš„æ€»ç»“ç»éªŒï¼Œç±»ä¼¼äºâ€œä¹…ç—…æˆåŒ»â€çš„æ„Ÿè§‰ å†…å®¹æŒ‰ç…§ 201706 - 201806 æœŸé—´ä½¿ç”¨ç»éªŒæ•´ç†ï¼Œåç»­å¤§è‡´æ˜¯ä¸ä¼šé‡è§äº†ï¼Œå› ä¸ºæœ‰äº†æ–°" /><meta name="keywords" content="TiDB, AirPlan, TiDB OPS, tidb-operator, 2pc, raft, databases, mysql, htap" />






<meta name="generator" content="Hugo 0.78.2 with theme even" />


<link rel="canonical" href="https://ap.tidb.cc/post/20180605-syncer-mindmap/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link href="/dist/even.04bd84cd.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="æ€»ç»“ - Syncer åŠ©åŠ›æ€ç»´æˆé•¿" />
<meta property="og:description" content="0x00 èƒŒæ™¯ é•¿æœŸä½¿ç”¨ Syncer ä¹‹åç»è¿‡ä¸€ç•ªèƒ¡æ€ä¹±æƒ³ä¹‹åçš„æ€»ç»“ç»éªŒï¼Œç±»ä¼¼äºâ€œä¹…ç—…æˆåŒ»â€çš„æ„Ÿè§‰ å†…å®¹æŒ‰ç…§ 201706 - 201806 æœŸé—´ä½¿ç”¨ç»éªŒæ•´ç†ï¼Œåç»­å¤§è‡´æ˜¯ä¸ä¼šé‡è§äº†ï¼Œå› ä¸ºæœ‰äº†æ–°" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ap.tidb.cc/post/20180605-syncer-mindmap/" />
<meta property="article:published_time" content="2018-06-05T00:00:00+08:00" />
<meta property="article:modified_time" content="2020-01-20T00:00:00+08:00" />
<meta itemprop="name" content="æ€»ç»“ - Syncer åŠ©åŠ›æ€ç»´æˆé•¿">
<meta itemprop="description" content="0x00 èƒŒæ™¯ é•¿æœŸä½¿ç”¨ Syncer ä¹‹åç»è¿‡ä¸€ç•ªèƒ¡æ€ä¹±æƒ³ä¹‹åçš„æ€»ç»“ç»éªŒï¼Œç±»ä¼¼äºâ€œä¹…ç—…æˆåŒ»â€çš„æ„Ÿè§‰ å†…å®¹æŒ‰ç…§ 201706 - 201806 æœŸé—´ä½¿ç”¨ç»éªŒæ•´ç†ï¼Œåç»­å¤§è‡´æ˜¯ä¸ä¼šé‡è§äº†ï¼Œå› ä¸ºæœ‰äº†æ–°">
<meta itemprop="datePublished" content="2018-06-05T00:00:00+08:00" />
<meta itemprop="dateModified" content="2020-01-20T00:00:00+08:00" />
<meta itemprop="wordCount" content="3320">



<meta itemprop="keywords" content="Syncer,enterprise tools," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="æ€»ç»“ - Syncer åŠ©åŠ›æ€ç»´æˆé•¿"/>
<meta name="twitter:description" content="0x00 èƒŒæ™¯ é•¿æœŸä½¿ç”¨ Syncer ä¹‹åç»è¿‡ä¸€ç•ªèƒ¡æ€ä¹±æƒ³ä¹‹åçš„æ€»ç»“ç»éªŒï¼Œç±»ä¼¼äºâ€œä¹…ç—…æˆåŒ»â€çš„æ„Ÿè§‰ å†…å®¹æŒ‰ç…§ 201706 - 201806 æœŸé—´ä½¿ç”¨ç»éªŒæ•´ç†ï¼Œåç»­å¤§è‡´æ˜¯ä¸ä¼šé‡è§äº†ï¼Œå› ä¸ºæœ‰äº†æ–°"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">TiDB AirPlan</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/post/">
        <li class="mobile-menu-item">Blog</li>
      </a><a href="/look/">
        <li class="mobile-menu-item">Look</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">TiDB AirPlan</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/post/">Blog</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/look/">Look</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">æ€»ç»“ - Syncer åŠ©åŠ›æ€ç»´æˆé•¿</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-06-05 </span>
        <div class="post-category">
            <a href="/categories/troubleshooting/"> Troubleshooting </a>
            </div>
          <span class="more-meta"> 3320 words </span>
          <span class="more-meta"> 7 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#0x00-èƒŒæ™¯">0x00 èƒŒæ™¯</a></li>
    <li><a href="#0x01-syncer-faq">0x01 Syncer-FAQ</a></li>
    <li><a href="#0x02-ä¸šåŠ¡é€»è¾‘">0x02 ä¸šåŠ¡é€»è¾‘</a></li>
    <li><a href="#0x03-æ€§èƒ½è°ƒä¼˜">0x03 æ€§èƒ½è°ƒä¼˜</a></li>
    <li><a href="#0x04-é—®é¢˜æ•´ç†">0x04 é—®é¢˜æ•´ç†</a>
      <ul>
        <li><a href="#ä¸Šä¸‹æ¸¸-schema-ä¸ä¸€è‡´åœºæ™¯">ä¸Šä¸‹æ¸¸ schema ä¸ä¸€è‡´åœºæ™¯</a></li>
        <li><a href="#unsupported-ddl">unsupported DDL</a></li>
        <li><a href="#å¯åŠ¨-syner-å¤±è´¥">å¯åŠ¨ Syner å¤±è´¥</a></li>
        <li><a href="#æ•°æ®åŒæ­¥ä¸æ­£å¸¸æˆ–æ•°æ®ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´">æ•°æ®åŒæ­¥ä¸æ­£å¸¸æˆ–æ•°æ®ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´</a></li>
        <li><a href="#mysql-a--b--c--syncer-åŒæ­¥åœºæ™¯">MySQL A &gt; B &gt; C &gt; Syncer åŒæ­¥åœºæ™¯</a></li>
      </ul>
    </li>
    <li><a href="#0x05-å·²-fixbug">0x05 å·² fixbug</a>
      <ul>
        <li><a href="#gtid-å¼€å…³é—®é¢˜">GTID å¼€å…³é—®é¢˜</a></li>
        <li><a href="#syncer-æœªå…³é—­çš„é•¿è¿æ¥">Syncer æœªå…³é—­çš„é•¿è¿æ¥</a></li>
      </ul>
    </li>
    <li><a href="#0x06-é—®é¢˜æ’æŸ¥ç¤ºä¾‹">0x06 é—®é¢˜æ’æŸ¥ç¤ºä¾‹</a>
      <ul>
        <li><a href="#å¼€å¯-debug-æ—¥å¿—">å¼€å¯ Debug æ—¥å¿—</a></li>
        <li><a href="#æŸ¥çœ‹ä¸‹æ¸¸-tidb-æ—¥å¿—">æŸ¥çœ‹ä¸‹æ¸¸ TiDB æ—¥å¿—</a></li>
        <li><a href="#æŸ¥çœ‹è¿è¡ŒçŠ¶æ€">æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>[NOTE] Updated <span class="timeago" datetime="2020-01-20T00:00:00" title="January 20, 2020">January 20, 2020</span>. This article may have outdated content or subject matter.</p>
    </div>
  </div>
    <div class="post-content">
      <h2 id="0x00-èƒŒæ™¯">0x00 èƒŒæ™¯</h2>
<blockquote>
<p>é•¿æœŸä½¿ç”¨ Syncer ä¹‹åç»è¿‡ä¸€ç•ªèƒ¡æ€ä¹±æƒ³ä¹‹åçš„æ€»ç»“ç»éªŒï¼Œç±»ä¼¼äºâ€œä¹…ç—…æˆåŒ»â€çš„æ„Ÿè§‰
å†…å®¹æŒ‰ç…§ 201706 - 201806 æœŸé—´ä½¿ç”¨ç»éªŒæ•´ç†ï¼Œåç»­å¤§è‡´æ˜¯ä¸ä¼šé‡è§äº†ï¼Œå› ä¸ºæœ‰äº†æ–°å·¥å…·ï¼ˆDMï¼‰</p>
</blockquote>
<h2 id="0x01-syncer-faq">0x01 Syncer-FAQ</h2>
<ul>
<li>ä½¿ç”¨ Syncer å‰è¯·è¯¦ç»†é˜…è¯»å®˜æ–¹ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md">Syncer</a> æ–‡æ¡£</li>
<li>Syncer æ˜¯ä¸€ä¸ª <strong>åŒæ­¥å·¥å…·</strong> ï¼Œé€šè¿‡ Syncer é…ç½®æ–‡ä»¶ä¸­çš„ [from] è·å–ä¸Šæ¸¸ MySQL binlog ä¿¡æ¯ï¼Œè§£æ binlog åä¼šæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„ skip-dmlsã€skip-ddlsã€replicate-do-dbã€replicate-do-tableã€route-rules ç­‰å‚æ•°åŒ¹é… or è¿‡æ»¤ï¼Œç„¶åå°†åŒ¹é… or è¿‡æ»¤åçš„æ•°æ®é›†é€šè¿‡ SQL Client çš„æ–¹å¼å†™å…¥åˆ° [to] ä¸‹æ¸¸æ•°æ®åº“</li>
</ul>
<h2 id="0x02-ä¸šåŠ¡é€»è¾‘">0x02 ä¸šåŠ¡é€»è¾‘</h2>
<p><img src="180101-Syncer-FAQ.svg" alt="Syncer ä¸šåŠ¡é€»è¾‘ï¼Œby: https://github.com/BigerCAP"></p>
<ul>
<li>Syncer æ˜¯ä¸ªåŒæ­¥å·¥å…·ï¼ŒSyncer ä¸­åˆ†ä¸‰ä¸ªéƒ¨åˆ†
<ul>
<li><strong>ä¸Šæ¸¸</strong> binlog æ•°æ®è¯»å–ï¼šè¿™æ˜¯ä¸ªå•çº¿ç¨‹æ¨¡æ‹Ÿè¯»å– MySQL binlog å†…å®¹ï¼ŒSyncer é’ˆå¯¹ from binlog æœ‰ä¸€å®šçš„ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#syncer-%E5%90%8C%E6%AD%A5%E5%89%8D%E6%A3%80%E6%9F%A5">çº¦æŸæ£€æŸ¥</a>ï¼Œæ£€æŸ¥é€šè¿‡åå¼€å§‹æ‹‰å–æ•°æ®å¹¶è¿›è¡Œæ•°æ®é¢„å¤„ç†å·¥ä½œ
<ul>
<li>ç›®å‰ Syncer æ‹‰å– binlog ä¸å­˜åœ¨æ€§èƒ½ç“¶é¢ˆ (è¿œç¨‹ç½‘ç»œè¯»å– binlog ä¼šå—å¸¦å®½è´¨é‡å½±å“)</li>
<li>æ•°æ®é¢„å¤„ç†å·¥ä½œæ˜¯ä¸»åŠ¨å»æ‰ TiDB ç›®å‰ä¸æ”¯æŒçš„ SQL format ã€DML SQL format è½¬æ¢ã€DDL Spilt ç­‰å†…å®¹</li>
</ul>
</li>
<li><strong>ä¸­å±‚</strong> æ•°æ®å¤„ç†ï¼šå°†ä¸Šæ¸¸é¢„å¤„ç†çš„æ•°æ®ä¸é…ç½®æ–‡ä»¶ä¸­çš„ <code>skip-dmlsã€skip-ddlsã€replicate-do-dbã€replicate-do-tableã€route-rule</code> å‚æ•°åšæ•°æ®è¿‡æ»¤ã€æ•°æ®åŒ¹é…ã€æ•°æ®è½¬æ¢ã€æ•°æ®æ£€æŸ¥
<ul>
<li>æ­¤å¤„ä¼šæ¶ˆè€— Syncer æ‰€åœ¨ä¸»æœºçš„è®¡ç®—èµ„æºã€å†…å­˜èµ„æº</li>
</ul>
</li>
<li><strong>ä¸‹æ¸¸</strong> æ•°æ®æ¶ˆè´¹ï¼šSyncer ä½œä¸º SQL Client é“¾æ¥ TiDB æ¶ˆè´¹æ•°æ®ï¼Œç”±é…ç½®æ–‡ä»¶ä¸­ worker-count * batch æ§åˆ¶ Syncer æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦
<ul>
<li>åœ¨æ•°æ®æ¶ˆè´¹æ—¶ binlog çš„è¯­å¥ä¼šè¢«ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ›¿æ¢ï¼š
<ul>
<li>insert == replace</li>
<li>update == update / update == delete + replace (safemode)</li>
<li>delete == delete</li>
</ul>
</li>
<li>æ•°æ®æ¶ˆè´¹è¿‡ç¨‹ä¸­ä¼šè®°å½•ä¸‹æ•°æ®åŒæ­¥æ–­ç‚¹ï¼šSyncer æ–­ç‚¹è®°å½•åœ¨ Syncer.meta æ–‡ä»¶ä¸­ï¼Œ æ ¼å¼æ˜¯ binlog-nameã€Position ä¸ GTID
<ul>
<li>Syncer ä¼šå°†ä¸Šæ¸¸ä¸€ä¸ªå¤§äº‹åŠ¡è¿›è¡Œåˆ‡åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡åˆ°ä¸‹æ¸¸æ‰§è¡Œï¼Œå¦‚åœ¨ä¸€ä¸ªå¤§äº‹åŠ¡å†…å‘ç”Ÿé€€å‡ºï¼ŒSyncer å†æ¬¡å¯åŠ¨æ—¶ä¼šé‡æ–°æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡</li>
<li>Syncer æ˜¯ä»¥ ROW format binlog è¿›è¡Œå›æ”¾ SQL è¯­å¥ï¼Œå³ä½¿äº‹åŠ¡è¢«é‡å¤æ‰§è¡Œä¹Ÿä¼šä¿æŒä¸€è‡´æ€§</li>
</ul>
</li>
<li>æ­¤å¤„ä¼šæ¶ˆè€— Syncer æ‰€åœ¨ä¸»æœºçš„ç½‘ç»œèµ„æº</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x03-æ€§èƒ½è°ƒä¼˜">0x03 æ€§èƒ½è°ƒä¼˜</h2>
<ul>
<li>Syncer æ ¹æ®ä¸‹æ¸¸æ¶ˆè´¹èƒ½åŠ›è°ƒæ•´ worker-count ä¸ batch å‚æ•°æ§åˆ¶å…¶åŒæ­¥é€Ÿåº¦ï¼Œworker-count æä¾›äº†å¹¶å‘èƒ½åŠ›ï¼Œbatch æ˜¯æ¯ä¸ªå¹¶å‘çš„æ•°æ®é‡
<ul>
<li>worker-count å·¥ä½œèƒ½åŠ›å— syncer æ‰€åœ¨æœºå™¨çš„ CPU å½±å“ï¼Œ worker-count ä¸ CPU è‡³å°‘æ˜¯ 1:1 å…³ç³»</li>
<li>é¦–å…ˆæé«˜ worker-count(1-256 ä¹‹é—´) ï¼Œbatch å›ºå®š (æ¯”å¦‚ 100 )ï¼Œå½“è°ƒå¤§ worker-count æ— æ³•åŠ å¿«æ¶ˆè´¹æ—¶ï¼Œå¯ä»¥é€‚å½“å¢åŠ  batch å¤§å°ï¼Œä¸å»ºè®®è¶…è¿‡ 1000
<ul>
<li>è°ƒæ•´ worker-count * batch æ—¶åº”å½“æ³¨æ„ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88" title="çœ‹è¿™é‡Œå¯ä»¥çŸ¥é“å¦‚ä½•é…ç½® Syncer ç›‘æ§">Syncer dashboard</a> ä¸­çš„ <code>syncer_txn_costs_gauge_in_second</code> Panelï¼Œè¯¥é¡¹ä¸º Syncer æ‰§è¡Œè¯­å¥åˆ°ä¸‹æ¸¸æ¶ˆè´¹æˆåŠŸçš„æ—¶é•¿ (æ­£å¸¸è¯¥æ•°å€¼åœ¨ ms çº§)</li>
</ul>
</li>
<li>worker count * batch ç­‰äºæœ€å¤§æ¶ˆè´¹ QPS ï¼Œå®é™…è¿è¡Œè¿‡ç¨‹ä¼šä½äºè¿™ä¸ªå‡è®¾å€¼ï¼Œå°¤å…¶å½“å†…å¤–ç½‘ä¹‹é—´è¿›è¡ŒåŒæ­¥æ—¶ï¼Œæ­¤æ—¶åº”å½“æ³¨æ„å†…å¤–ç½‘ä¹‹é—´çš„æœ€å¤§å¸¦å®½</li>
</ul>
</li>
</ul>
<h2 id="0x04-é—®é¢˜æ•´ç†">0x04 é—®é¢˜æ•´ç†</h2>
<ul>
<li>Syncer åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé‡è§ä»¥ä¸‹é”™è¯¯ï¼š
<ol>
<li>Syncer è§£æ binlog å‡ºé”™ï¼šSyncer ç›®å‰æ”¯æŒçš„ binlog æœ‰é™ï¼Œåˆå§‹æ—¶æŒ‰ç…§ MySQL 5.7\5.6 ç‰ˆæœ¬å¼€å‘ï¼ŒåæœŸåŠ å…¥äº† MariaDB 10 ï¼›å¦‚æœä½¿ç”¨ç‰ˆæœ¬ä¸åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…å¯èƒ½ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸é”™è¯¯ã€‚åŒæ—¶ MySQL ä¸ MariaDB è‡ªèº«è½¯ä»¶ä¹Ÿä¼šäº§ç”Ÿä¸€äº› binglog ç›¸å…³çš„ BUGï¼Œè¿™ç±» BUG éœ€è¦å‡çº§è½¯ä»¶ç‰ˆæœ¬æ‰å¯ä»¥è§£å†³</li>
<li>Syncer æ’å…¥æ•°æ®åˆ°ä¸‹æ¸¸å‡ºé”™ï¼šæ­¤ç±»ä¸€èˆ¬æ˜¯ä¸‹æ¸¸ TiDB ä¸æ”¯æŒã€‚æ­¤ç±»æŠ¥é”™ä¸ SQL Client æ‰§è¡Œ SQL è¯­å¥å¾—åˆ°çš„æŠ¥é”™ä¸€è‡´</li>
<li>Syncer å› ä¸ºæŸäº›äº‹ä»¶äº§ç”Ÿ panic (å¦‚ä½¿ç”¨äº†æ¯”è¾ƒè€ç‰ˆæœ¬çš„ MySQL)ï¼šæ­¤æ—¶éœ€è¦è”ç³» PingCAP å®˜æ–¹æŠ€æœ¯æ”¯æŒï¼Œå‘é€ä¸šåŠ¡åœºæ™¯ã€ä½¿ç”¨ç–‘é—®ä¿¡æ¯åˆ° <a href="mailto:info@pingcap.com">info@pingcap.com</a></li>
<li>Syncer ä½¿ç”¨è¿‡ç¨‹ä¸­å…¶ä»–é”™è¯¯ï¼šå¦‚æ•°æ®åº“æƒé™é—®é¢˜ã€ç½‘ç»œé—ªæ–­æˆ–ä¸å¯è¾¾ã€ä¸‹æ¸¸æ¶ˆè´¹å‡ºç°å µå¡ã€å†™å…¥å†²çªã€æ•°æ®åŒæ­¥æ…¢ã€æ•°æ®åŒæ­¥ä¸æ­£å¸¸ ç­‰ï¼Œå…¶å®å‡å¯é€šè¿‡è‡ªå»ºä¸é˜…è¯»æ–‡æ¡£è§£å†³</li>
</ol>
</li>
<li>Syncer å‡ºç°é—®é¢˜æ—¶åº”å½“å…ˆè¿›è¡Œè‡ªæ£€ï¼Œå®Œæˆä»¥ä¸‹æ­¥éª¤å†…å®¹
<ul>
<li>Sycner <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#syncer-%E5%90%8C%E6%AD%A5%E5%89%8D%E6%A3%80%E6%9F%A5">åŒæ­¥å‰çš„ä¸€äº›æ£€æŸ¥é¡¹</a> ï¼šæ£€æŸ¥ä¸Šä¸‹æ¸¸ä¹‹é—´çš„å‚æ•°æ˜¯å¦ç¬¦åˆéœ€æ±‚</li>
<li>Syncer <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#%E7%9B%91%E6%8E%A7%E6%96%B9%E6%A1%88">ç›‘æ§é¡¹ / å‘Šè­¦é¡¹é…ç½®</a> ï¼šè®¾ç½®è¿™ä¸ªå¯ä»¥è§‚å¯Ÿ Syncer è¿è¡ŒçŠ¶æ€</li>
<li>Syncer æ•°æ®åŒæ­¥ä¸æ­£å¸¸ï¼Œåº”å½“å…ˆæ£€æŸ¥ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#%E5%90%AF%E5%8A%A8-syncer">é…ç½®æ–‡ä»¶</a> ä¸ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5">route-rule</a>ï¼Œæ£€æŸ¥è¿™äº›æ˜¯å¦ä¸æœŸæœ›ç›¸ç­‰</li>
<li>Syncer <a href="../Docs/180323-Systemd-Syncer.md">å¯åŠ¨æ–¹å¼ä¸å®ˆæŠ¤è¿›ç¨‹</a></li>
</ul>
</li>
</ul>
<h3 id="ä¸Šä¸‹æ¸¸-schema-ä¸ä¸€è‡´åœºæ™¯">ä¸Šä¸‹æ¸¸ schema ä¸ä¸€è‡´åœºæ™¯</h3>
<ul>
<li>è¯¥é—®é¢˜ä¸»è¦å‡ºç°äºåˆ†åº“åˆ†è¡¨ï¼Œä¸Šæ¸¸æ‰§è¡Œ DDL åï¼ŒSyncer å‡ºç°ä¸Šä¸‹æ¸¸ schema ä¿¡æ¯ä¸ä¸€è‡´ã€‚</li>
<li>åŸå› æ˜¯ä¸Šæ¸¸åˆ†è¡¨åŒæ­¥è¿›æ­¥ä¸ä¸€è‡´ï¼Œæ²¡æœ‰æœ‰æ•ˆçš„é€šè¿‡ä¸­æ§æœºåˆ¶é”ä½æ‰€æœ‰åˆ†è¡¨çš„ DDL æ‰§è¡ŒçŠ¶æ€ã€‚</li>
<li>æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">2018/07/18 19:21:17 main.go:79: [error] /home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/syncer.go:529: gen insert sqls failed: insert columns and data mismatch in length: 25 vs 23, schema: CRM, table: ORDER
/home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/syncer.go:165:
2018/07/18 19:21:17 syncer.go:752: [info] print status exits, err:context canceled
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>æ ¸éªŒæ­¥éª¤</p>
<ul>
<li>é€šè¿‡ <code>show create table tablename</code> æ ¸å®ä¸Šä¸‹æ¸¸ schema info ï¼Œæˆ–è€…é€šè¿‡ mysqlbinlog æŸ¥çœ‹ binlog å†…å®¹ï¼Œæˆ–è€… syncer å¼€å¯ Debug æ¨¡å¼æŸ¥çœ‹è¾“å‡º
<ul>
<li>mysqlbinlog ç¤ºä¾‹å¦‚ä¸‹ (æ³¨æ„ä¿®æ”¹ binlogname ä¸ pos ç‚¹ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨ log æˆ–è€… syncer.meta ä¸­çš„ä¿¡æ¯)
<ul>
<li><code>mysqlbinlog --base64-output=DECODE-ROWS  mysql-bin.002019 --start-position 430862799 --stop-position 430866627 -vv</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>å¦‚æœæ•°æ®é‡å°ï¼Œå¯ä»¥ä»æ–°æ¥ä¸€éå…¨é‡ï¼Œç„¶åå†åšå¢é‡æ•°æ®</li>
<li>è”ç³» PingCAP å®˜æ–¹æœåŠ¡ï¼Œå®˜æ–¹ä¼šè§£å†³è¯¦ç»†è§£å†³æ–¹æ¡ˆã€‚
<ul>
<li>æ¯”å¦‚ï¼šå»æ‰ä¸Šä¸‹æ¸¸ schema æ£€æŸ¥ï¼Œè¿™ç§ä¼šæœ‰ä¸€å®šçš„æ½œåœ¨é—®é¢˜ï¼Œå¦‚å…ˆæ‰§è¡Œ <code>alter table A add column</code>ï¼Œç´§éšæ‰§è¡Œ <code>alter table A delete column</code>ï¼Œæ­¤æ—¶æ•°æ®ä¼šæœ‰å½±å“ã€‚</li>
<li>æˆ–è€…ä½¿ç”¨ Syncer å‡çº§ç‰ˆ Data Migration Product Proposal (DM)ï¼Œéœ€è¦è”ç³» PingCAP å•†åŠ¡æ”¯æŒ <a href="mailto:info@pingcap.com">info@pingcap.com</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="unsupported-ddl">unsupported DDL</h3>
<blockquote>
<p>Error 1105: unsupported modify column null to not null</p>
</blockquote>
<ul>
<li>
<p>Syncer æ—¥å¿—æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="mi">2018</span><span class="o">/</span><span class="mi">09</span><span class="o">/</span><span class="mi">28</span> <span class="mi">18</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">54</span> <span class="n">db</span><span class="p">.</span><span class="k">go</span><span class="p">:</span><span class="mi">123</span><span class="p">:</span> <span class="p">[</span><span class="n">warning</span><span class="p">]</span> <span class="p">[</span><span class="k">exec</span><span class="p">][</span><span class="k">sql</span><span class="p">]</span><span class="n">USE</span> <span class="o">`</span><span class="n">qxf</span><span class="o">`</span><span class="p">;</span> <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">fof_strategy</span><span class="o">`</span> <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="o">`</span><span class="n">start_date</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;[</span><span class="n">args</span><span class="p">][][</span><span class="n">error</span><span class="p">]</span><span class="n">Error</span> <span class="mi">1105</span><span class="p">:</span> <span class="n">unsupported</span> <span class="k">modify</span> <span class="k">column</span> <span class="k">null</span> <span class="k">to</span> <span class="k">not</span> <span class="k">null</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>é—®é¢˜åŸå› </p>
<ul>
<li>è¿™ä¸ªé”™è¯¯æ˜¯ TiDB ä¸æ”¯æŒ  default null ä¸ default not null ä¹‹é—´çš„äº’ç›¸è½¬æ¢ã€‚è¯¦æƒ…é˜…è¯» <a href="https://github.com/pingcap/docs-cn/blob/master/sql/ddl.md#alter-table-%E8%AF%AD%E6%B3%95">å®˜æ–¹æ–‡æ¡£ DDL ä¹‹ Alter table</a></li>
</ul>
</li>
</ul>
<h3 id="å¯åŠ¨-syner-å¤±è´¥">å¯åŠ¨ Syner å¤±è´¥</h3>
<ul>
<li>
<p>Meta æ–‡ä»¶æˆ–è€…é…ç½®æ–‡ä»¶å‚æ•°æœ‰å›è½¦ç¬¦</p>
<ul>
<li><code>[error] Near line 3 (last key parsed ''): Strings cannot contain new lines.</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">2017/12/14 08:36:20 main.go:52: [info] config: log-level:info log-file:/root/prega-syncer/log/card.log log-rotate:day status-addr::11105 server-id:999 worker-count:32 batch:100 meta-file:/root/prega-syncer/meta/card.meta do-tables:[] do-dbs:[~^mmm*] ignore-tables:[] ignore-dbs:[] from:DBConfig(host:10.1.1.14, user:root, port:3306, pass:&lt;omitted&gt;) to:DBConfig(host:10.1.1.25, user:syncer, port:5555, pass:&lt;omitted&gt;) skip-sqls:[] route-rules:[] enable-gtid:true safe-mode:false git-hash: ba3ca1271bb63d58f4d4eecf6d189e353b40440a utc-build-time:[2017-11-23 11:34:40] go-version:go1.9.2
2017/12/14 08:36:20 main.go:75: [error] Near line 3 (last key parsed &#39;&#39;): Strings cannot contain new lines.
/home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/meta.go:85:
/home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/syncer.go:136:
2017/12/14 08:36:20 metrics.go:107: [info] listening on :11105 for status and metrics report.
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="æ•°æ®åŒæ­¥ä¸æ­£å¸¸æˆ–æ•°æ®ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´">æ•°æ®åŒæ­¥ä¸æ­£å¸¸æˆ–æ•°æ®ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´</h3>
<blockquote>
<p>æ•°æ®åŒæ­¥ä¸æ­£å¸¸æˆ–æ•°æ®ä¸Šä¸‹æ¸¸ä¸ä¸€è‡´é—®é¢˜æ£€æŸ¥</p>
</blockquote>
<ul>
<li>
<p>è‡ªæ£€ <a href="https://github.com/pingcap/docs-cn/blob/master/tools/syncer.md#syncer-%E5%90%8C%E6%AD%A5%E5%89%8D%E6%A3%80%E6%9F%A5">checklist</a></p>
</li>
<li>
<p>Syncer æ­£å¸¸è¿è¡Œï¼Œä¸»åº“æœ‰æ’å…¥æ•°æ®ï¼Œå¤‡åº“ä¸åŒæ­¥</p>
<ul>
<li>
<p>æ£€æŸ¥ binlog æ˜¯å¦å­˜åœ¨</p>
</li>
<li>
<p>æ£€æŸ¥ binlog æ ¼å¼</p>
</li>
<li>
<p>æ£€æŸ¥ binlog å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">MySQL</span> <span class="p">[(</span><span class="k">none</span><span class="p">)]</span><span class="o">&gt;</span> <span class="k">show</span> <span class="n">master</span> <span class="n">logs</span><span class="p">;</span>
<span class="o">+</span><span class="c1">------------------+------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">Log_name</span>         <span class="o">|</span> <span class="n">File_size</span>  <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">mysql</span><span class="o">-</span><span class="n">bin</span><span class="p">.</span><span class="mi">000023</span> <span class="o">|</span> <span class="mi">1073742014</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql</span><span class="o">-</span><span class="n">bin</span><span class="p">.</span><span class="mi">000024</span> <span class="o">|</span> <span class="mi">1073742302</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">mysql</span><span class="o">-</span><span class="n">bin</span><span class="p">.</span><span class="mi">000025</span> <span class="o">|</span>  <span class="mi">101832651</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">------------------+------------+
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>å¦‚ä½•åŒºåˆ† binlog å†…å®¹æ ¼å¼ä¸º row æ¨¡å¼</p>
<ul>
<li>ä½¿ç”¨ <code>show master logs;</code> æŸ¥åˆ°æœ€æ–°çš„ binlog file name ã€‚</li>
<li>ä½¿ç”¨ <code>show binlog events in 'mysql-bin.000025'  limit 10;</code></li>
<li>æŸ¥çœ‹ Event_type åˆ—æ˜¯å¦æœ‰ <code>Write_rows</code> <code>Update_rows</code> ç­‰å€¼ã€‚</li>
</ul>
</li>
<li>
<p><code>SET GLOBAL binlog_format = ROW;</code> ä¿®æ”¹ binlog æ ¼å¼åï¼Œä¸‹ä¸€ä¸ª binlog file æ‰ä¼šç”Ÿæ•ˆã€‚</p>
<ul>
<li>æ‰§è¡Œ <code>flush logs;</code> æ‰‹åŠ¨åˆ·æ–°ç”Ÿæˆ binlog file ã€‚</li>
</ul>
</li>
<li>
<p>æŸ¥çœ‹ binlog æ–‡ä»¶å¤§å°</p>
<ul>
<li>
<p>é»˜è®¤ binlog file size  <code>show global variables like '%max_binlog_size%';</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="o">+</span><span class="c1">-----------------+------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">Variable_name</span>   <span class="o">|</span> <span class="n">Value</span>      <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">max_binlog_size</span> <span class="o">|</span> <span class="mi">1073741824</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-----------------+------------+
</span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
<h3 id="mysql-a--b--c--syncer-åŒæ­¥åœºæ™¯">MySQL A &gt; B &gt; C &gt; Syncer åŒæ­¥åœºæ™¯</h3>
<p><img src="180101-Syncer-FAQ-181123.svg" alt="MySQL ä¸»ä»ä»æ¶æ„"></p>
<ul>
<li>MySQL ç”Ÿäº§ç¯å¢ƒæ•°æ®ç¯å¢ƒé€šè¿‡ MySQL â€œä¸»ä»ä»â€ æ¶æ„å®ç°é«˜å¯ç”¨ç¾å¤‡æ¨¡å¼
<ul>
<li>åœ¨è¯¥æ¨¡å¼åé¢æ”¾ç½® syncer å·¥å…·åŒæ­¥æ•°æ®åˆ° TiDB Cluster, å¦‚æœæœªå¼€å¯ log slave update å‚æ•°ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
<li>è¯¥å‚æ•°å…·ä½“åŠŸèƒ½ä»¥åŠä¸»ä»ä¹‹é—´å…¶ä»–å‚æ•°å¯ä»¥æŸ¥çœ‹ MySQL å®˜ç½‘ <a href="https://dev.mysql.com/doc/refman/8.0/en/replication-options-slave.html" title="TiDB-OPS, --log-slave-updates , MySQL ä¸»ä»ä»æ¨¡å¼">17.1.6.3 Replication Slave Options and Variables</a></li>
</ul>
</li>
<li>è¯¥å‚æ•°åŠŸèƒ½
<ul>
<li>ä»åº“åªå¼€å¯ log-bin åŠŸèƒ½ï¼Œä¸ä½¿ç”¨ log-slave-updates åŠŸèƒ½
<ul>
<li>ä»åº“åœ¨ä¸»åº“å¤åˆ¶çš„æ•°æ®ï¼Œä¸ä¼šå†™å…¥ log-bin æ–‡ä»¶</li>
<li>ç›´æ¥å‘ä»åº“å†™å…¥æ•°æ®æ—¶ï¼Œä¼šå†™å…¥ log-bin æ–‡ä»¶</li>
<li>æ­¤æ—¶ syncer è¯»åˆ°çš„æ•°æ®å¹¶ä¸æ˜¯æœ€ç»ˆå®Œæ•´æ•°æ®</li>
</ul>
</li>
<li>ä»åº“å¼€å¯ log-slave-updates åŠŸèƒ½
<ul>
<li>ä»åº“ä»ä¸»åº“å¤åˆ¶çš„æ•°æ®ä¼šå†™å…¥ log-bin æ—¥å¿—æ–‡ä»¶é‡Œ</li>
<li>æ­¤æ—¶ syncer å¯è¯»åˆ°æœ€ç»ˆå®Œæ•´æ•°æ®</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="0x05-å·²-fixbug">0x05 å·² fixbug</h2>
<h3 id="gtid-å¼€å…³é—®é¢˜">GTID å¼€å…³é—®é¢˜</h3>
<ul>
<li>
<p>UUID è·å–é—®é¢˜</p>
<ul>
<li>Syncer å¼•å…¥ UUID åº“ç‰ˆæœ¬é—®é¢˜ï¼Œå³æ—¶æ²¡æœ‰å¼€å¯ enable-gtidï¼Œä¹Ÿä¼šè§£æ binlog ä¸­ UUID ä¿¡æ¯ï¼Œè§£ææ•°æ®æ—¶å¤±è´¥</li>
<li>ä¸ syncer.meta æ–‡ä»¶å†… <code>binlog-gtid = &quot;&quot;</code> ä¿¡æ¯æ— å…³</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">2018/01/17 13:58:17 main.go:75: [error] uuid: invalid version number: %!s(uint8=101)
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="syncer-æœªå…³é—­çš„é•¿è¿æ¥">Syncer æœªå…³é—­çš„é•¿è¿æ¥</h3>
<ul>
<li>
<p>MySQL ä¸Šæ¸¸å‡ºç°ç”± Syncer åˆ›å»ºçš„å¤§é‡é•¿è¿æ¥</p>
<ul>
<li>ä¸Šæ¸¸æŒç»­æœªæ’å…¥æ•°æ®ï¼ŒSyncer ä¼šå›ºå®šæ—¶é—´è¿›è¡Œé‡è¿è·å–æœ€æ–°ä¿¡æ¯</li>
<li>syncer æ¯éš”ä¸€ä¸ªå°æ—¶ä¼šè·å–ä¸€æ¬¡æ–°çš„æ•°æ®ï¼Œä½†åœ¨å»ºç«‹æ–°è¿æ¥çš„æ—¶å€™æœªå…³é—­è€çš„è¿æ¥ï¼Œå¯¼è‡´ mysql å‡ºç°éå¸¸å¤šçš„é•¿è¿æ¥ã€‚å¯¼è‡´ä¸šåŠ¡å‘Šè­¦ã€‚</li>
<li>ä¸»è¦åŸå› æ˜¯ï¼Œsyncer å»ºç«‹è¿æ¥æœªè¿›è¡Œæ­£ç¡®å…³é—­ã€‚</li>
<li>æ—¥å¿— tps æŒç»­ä¸º 0 ï¼Œé€šè¿‡ sql æŸ¥è¯¢ä¸Šä¸‹æ¸¸åŒæ­¥æ­£å¸¸</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">2017/12/30 00:17:40 syncer.go:803: [info] [syncer]total events = 102214510, total tps = 50, recent tps = 0, master-binlog = (mysql-bin.001244, 66802580), master-binlog-gtid=8c38f844-2985-11e7-a6f2-18ded76e567c:1-1838809963, syncer-binlog = (mysql-bin.001244, 66802580), syncer-binlog-gtid = 8c38f844-2985-11e7-a6f2-18ded76e567c:1-1838809963,b7ff0e7e-2985-11e7-a6f3-18ded76e34de:1-37
</code></pre></td></tr></table>
</div>
</div><ul>
<li>é€šè¿‡ <code>show processlist</code> æŸ¥çœ‹åˆ°å¾ˆå¤šé•¿è¿æ¥ï¼Œé€šè¿‡ç›¸é‚» time ç›¸å‡å¾—åˆ°å›ºå®šå€¼ 3614s ï¼Œç¡®å®šæ¯éš”ä¸€æ®µæ—¶é—´å»æ£€æŸ¥ä¸€æ¬¡ä¿¡æ¯ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="mi">849978</span>  <span class="n">sync_tidb</span>       <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">:</span><span class="mi">49773</span>        <span class="k">NULL</span>    <span class="n">Binlog</span> <span class="n">Dump</span> <span class="n">GTID</span>        <span class="mi">401307</span>  <span class="n">Master</span> <span class="n">has</span> <span class="n">sent</span> <span class="k">all</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">slave</span><span class="p">;</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">be</span> <span class="n">updated</span>   <span class="k">NULL</span>
<span class="mi">850140</span>  <span class="n">sync_tidb</span>       <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">:</span><span class="mi">60822</span>        <span class="k">NULL</span>    <span class="n">Binlog</span> <span class="n">Dump</span> <span class="n">GTID</span>        <span class="mi">397693</span>  <span class="n">Master</span> <span class="n">has</span> <span class="n">sent</span> <span class="k">all</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">slave</span><span class="p">;</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">be</span> <span class="n">updated</span>   <span class="k">NULL</span>
<span class="mi">850308</span>  <span class="n">sync_tidb</span>       <span class="mi">10</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">2</span><span class="p">:</span><span class="mi">43534</span>        <span class="k">NULL</span>    <span class="n">Binlog</span> <span class="n">Dump</span> <span class="n">GTID</span>        <span class="mi">394079</span>  <span class="n">Master</span> <span class="n">has</span> <span class="n">sent</span> <span class="k">all</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">slave</span><span class="p">;</span> <span class="n">waiting</span> <span class="k">for</span> <span class="n">binlog</span> <span class="k">to</span> <span class="n">be</span> <span class="n">updated</span>   <span class="k">NULL</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ä¿®å¤åŠæ³•ï¼šæ€æ‰ syncer è¿›ç¨‹ï¼Œç„¶åç™»é™† MySQL æ€æ­»æ‰€æœ‰é•¿è¿æ¥ã€‚</li>
</ul>
</li>
</ul>
<h2 id="0x06-é—®é¢˜æ’æŸ¥ç¤ºä¾‹">0x06 é—®é¢˜æ’æŸ¥ç¤ºä¾‹</h2>
<h3 id="å¼€å¯-debug-æ—¥å¿—">å¼€å¯ Debug æ—¥å¿—</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">2018/01/13 12:04:12 binlogsyncer.go:98: [info] create BinlogSyncer with config &amp;{100 mysql rm-bp173ev012345rp03.mysql.rds.tidbclouds.com 3306 g7pay_link_ro nxrwcQ47kdIn   false false &lt;nil&gt; false debug 0}
2018/01/13 12:04:12 metrics.go:107: [info] listening on :10073 for status and metrics report.
2018/01/13 12:04:12 binlogsyncer.go:274: [info] begin to sync binlog from position (mysql-bin.002019, 430862751)
2018/01/13 12:04:12 binlogsyncer.go:158: [info] register slave for master server rm-bp173ev012345rp03.mysql.rds.tidbclouds.com:3306
2018/01/13 12:04:12 binlogsyncer.go:632: [info] rotate to (mysql-bin.002019, 430862751)
2018/01/13 12:04:12 syncer.go:521: [info] rotate binlog to (mysql-bin.002019, 430862751)
2018/01/13 12:04:12 syncer.go:676: [debug] gtid information: binlog (mysql-bin.002019, 430862799), gtid b470bfb4-bdb4-11e6-a7e5-70106fac1460:1-277917818
2018/01/13 12:04:12 syncer.go:525: [debug] source-db:cat_link table:link_cat; target-db:cat_link table:link_cat, RowsEvent data: [[E78D56BBBC2357PPPBBBBCACD6EBD2AC åŒºåŸŸç»è¥ - åå— 118OO6009 åä¸­ - æ¡‚ç¼ - æŸ³å·é—¨åº— 118006GHJ025OO1 H00O6Q H00O6Q æµ™å¹¿ TiDB å‚¨ç‰©æµåŠ¨å…¬å¸ é™ˆç‹ 120123ABCD149rrr2 æ¡‚ A88888 0 2 æ¢ç‹ 18212238888 &lt;nil&gt; 0000-00-00 00:00:00 0 0 0000-00-00 00:00:00 å°èŠ³ lij 0 1 2018-01-12 21:10:09 &lt;nil&gt; 2  291464]]
2018/01/13 12:04:12 db.go:55: [debug] [query][sql]SHOW COLUMNS FROM `cat_link`.`link_cat`
2018/01/13 12:04:12 db.go:55: [debug] [query][sql]SHOW INDEX FROM `cat_link`.`link_cat`
2018/01/13 12:04:12 syncer.go:882: [info] flush all jobs meta = syncer-binlog = (mysql-bin.002019, 430862751), syncer-binlog-gtid = b470bfb4-bdb4-11e6-a7e5-70106fac1460:1-277917817
2018/01/13 12:04:12 meta.go:120: [info] save position to file, binlog-name:mysql-bin.002019 binlog-pos:430862751 binlog-gtid:b470bfb4-bdb4-11e6-a7e5-70106fac1460:1-277917817
2018/01/13 12:04:12 main.go:75: [error] /home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/syncer.go:556: gen insert sqls failed: insert columns and data mismatch in length: 27 vs 28, schema: cat_link, table: link_cat
/home/jenkins/workspace/build_tidb_enterprise_tools_master/go/src/github.com/pingcap/tidb-enterprise-tools/syncer/syncer.go:143:
2018/01/13 12:04:12 syncer.go:795: [info] print status exits, err:context canceled
2018/01/13 12:04:12 binlogsyncer.go:126: [info] syncer is closing...
2018/01/13 12:04:12 binlogstreamer.go:47: [error] close sync with err: sync is been closing...
2018/01/13 12:04:12 binlogsyncer.go:141: [info] syncer is closed
</code></pre></td></tr></table>
</div>
</div><h3 id="æŸ¥çœ‹ä¸‹æ¸¸-tidb-æ—¥å¿—">æŸ¥çœ‹ä¸‹æ¸¸ TiDB æ—¥å¿—</h3>
<ul>
<li>
<p>Syncer æ˜¯ä½œä¸ºä¸Šæ¸¸çš„æœåŠ¡ç«¯ï¼Œè·å–æ•°æ®è½¬æ¢åï¼Œä½œä¸ºä¸‹æ¸¸çš„å®¢æˆ·ç«¯æ’å…¥æ•°æ®ï¼Œä»¥ä¸‹ä¿¡æ¯æ˜¯åœ¨æ’å…¥æ•°æ®çš„æ—¶å€™é‡è§é”™è¯¯æ¥å—åˆ°çš„è¿”å›</p>
</li>
<li>
<p>Syncer æ—¥å¿—å†…æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼Œå®é™…æ˜¯ Syncer ä¸‹æ¸¸ TiDB è¿”å›çš„é”™è¯¯ä¿¡æ¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">begin failed Error 1105: [try again later]: backoffer.maxSleep 5000ms is exceeded, errors:
get timestamp failed: rpc error: code = Unknown desc = rpc error: code = Unavailable desc = not leader
get timestamp failed: rpc error: code = Unavailable desc = grpc: the connection is unavailable
get timestamp failed: rpc error: code = Unavailable desc = grpc: the connection is unavailable
db.goğŸ’¯ [warning] sql stmt_exec retry 90
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h3 id="æŸ¥çœ‹è¿è¡ŒçŠ¶æ€">æŸ¥çœ‹è¿è¡ŒçŠ¶æ€</h3>
<ul>
<li>æ£€æŸ¥ syncer æ˜¯å¦è¿˜åœ¨è¿è¡Œ</li>
<li>æŸ¥çœ‹ syncer æœ€å 50 è¡Œæ—¥å¿—ï¼Œæ ¹æ®æ—¥å¿—æç¤ºä¿®å¤</li>
<li>æç¤º <code>2017/08/01 08:28:59 binlogsyncer.go:554: [error] connection was bad</code></li>
<li>tidb é“¾æ¥ æºåº“ç½‘ç»œå‡ºç°å¼‚å¸¸ï¼Œtidb ä¼šé‡è¯•ä¸€æ®µæ—¶é—´åé€€å‡º</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Jeff</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-01-20
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a> ï½œ æœ¬æ–‡ä¸å¸¦ä»»ä½•å®˜æ–¹è‰²å½©ï¼Œæœ€ç»ˆè§£é‡Šæƒå½’æœ¬ç«™æ‰€æœ‰</span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/syncer/">Syncer</a>
          <a href="/tags/enterprise-tools/">enterprise tools</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/20180803-31-select-hash/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">School - TiDB æ ¹æ® PK æŸ¥è¯¢ä¸åˆ°æ•°æ®</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/20180512-drainer-crc/">
            <span class="next-text nav-default">Drainer &amp; Binlog crc mismatch</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/BigerCAP/TiDB-AirPlan/issues" class="iconfont icon-github" title="github"></a>
  <a href="https://ap.tidb.cc/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2017 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">TiDB - AirPlan</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "en".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>
<script type="text/javascript" src="/dist/even.26188efa.min.js"></script>








</body>
</html>
